```php
<?php
namespace Minimalism\Async\Core;


final class AsyncTask_ implements IAsync
{
    private $generator;
    private $complete;

    public function __construct(\Generator $generator)
    {
        $this->generator = new Generator($generator);
    }

    public function start(callable $complete = null)
    {
        $this->complete = $complete;
        $this->next();
    }

    public function next($result = null, \Exception $ex = null)
    {
        if ($ex instanceof CancelTaskException) {
            return;
        }
        try {
            if (!$this->generator->valid()) {
                goto complete;
            }
            if ($ex) {
                $value = $this->generator->throwex($ex);
            } else {
                $value = $this->generator->send($result);
            }
            if ($this->generator->valid()) {
                if ($value instanceof \Generator) {
                    $value = new self($value);
                }
                if ($value instanceof IAsync) {
                    $value->start([$this, "next"]);
                } else {
                    $this->next($value, null);
                }
            } else {
                complete:
                if ($cb = $this->complete) {
                    $cb($result, $ex);
                }
            }
        } catch (\Exception $ex) {
            $this->next(null, $ex);
        }
    }
}
```